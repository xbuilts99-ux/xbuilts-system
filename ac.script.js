(function(){const _0x1a="https://script.google.com/macros/s/AKfycbxwNoDIQlJtyBm4Y8t_Ta7o7ncALFlPw61RFlEb6k8Sdsa1RM08Te4W8O1uPWnU5mrgXg/exec";let _0x2b=[];let _0x3c=JSON.parse(localStorage.getItem('xbuilts_projects_v3')||'["‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô A","‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô B"]');window.updateConnectionStatus=function(_0x4d){const _0x5e=document.getElementById('connectionStatus');if(_0x4d==='loading'){_0x5e.className='text-xs bg-yellow-50 text-yellow-600 px-4 py-1.5 rounded-full font-bold border border-yellow-200 loading-pulse';_0x5e.innerText='‚óè ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'}else if(_0x4d==='success'){_0x5e.className='text-xs bg-green-50 text-green-600 px-4 py-1.5 rounded-full font-bold border border-green-200';_0x5e.innerText='‚óè ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Cloud ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}else{_0x5e.className='text-xs bg-red-50 text-red-600 px-4 py-1.5 rounded-full font-bold border border-red-200';_0x5e.innerText='‚óè ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'}};window.fetchData=async function(){updateConnectionStatus('loading');try{const _0x6f=await fetch(`${_0x1a}?t=${Date.now()}`);_0x2b=await _0x6f.json();processData(_0x2b);updateConnectionStatus('success')}catch(_0x7a){updateConnectionStatus('error');console.error(_0x7a)}};window.processData=function(_0x8b){if(!_0x8b||_0x8b.length<2){document.getElementById('transactionBody').innerHTML='<tr><td colspan="3" class="p-10 text-center text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';return}const _0x9c=_0x8b.slice(1);const _0x1d=document.getElementById('projectFilter').value;let _0x2e={inc:0,exp:0,vat:0,wht:0};let _0x3f={},_0x4a={},_0x5b={};const _0x6c=document.getElementById('transactionBody');_0x6c.innerHTML='';_0x9c.slice().reverse().forEach(_0x7d=>{const [_0x8e,_0x9f,_0x10a,_0x11b,_0x12c,_0x13d,_0x14e,_0x15f,_0x16a,_0x17b]=_0x7d;const _0x18c=new Date(_0x9f);const _0x19d=`${_0x18c.getFullYear()}-${(_0x18c.getMonth()+1).toString().padStart(2,'0')}`;const _0x20e=parseFloat(_0x17b)||0;const _0x21f=parseFloat(_0x14e)||0;const _0x22a=parseFloat(_0x15f)||0;const _0x23b=parseFloat(_0x16a)||0;if(!_0x4a[_0x19d])_0x4a[_0x19d]={inc:0,exp:0};if(_0x10a==='income')_0x4a[_0x19d].inc+=_0x20e;else _0x4a[_0x19d].exp+=_0x20e;if(!_0x5b[_0x19d])_0x5b[_0x19d]={base:0,vat:0,wht:0};if(_0x10a==='expense'){_0x5b[_0x19d].base+=_0x21f;_0x5b[_0x19d].vat+=_0x22a;_0x5b[_0x19d].wht+=_0x23b}if(!_0x3f[_0x11b])_0x3f[_0x11b]={inc:0,exp:0};if(_0x10a==='income')_0x3f[_0x11b].inc+=_0x20e;else _0x3f[_0x11b].exp+=_0x20e;if(_0x1d==='all'||_0x11b===_0x1d){if(_0x10a==='income')_0x2e.inc+=_0x20e;else _0x2e.exp+=_0x20e;_0x2e.vat+=_0x22a;_0x2e.wht+=_0x23b;_0x6c.innerHTML+=`<tr class="hover:bg-slate-50 transition border-b border-slate-50"><td class="p-4 text-[10px] text-slate-400 leading-tight">${_0x18c.toLocaleDateString('th-TH')}<br>${_0x18c.toLocaleTimeString('th-TH',{hour:'2-digit',minute:'2-digit'})}</td><td class="p-4"><div class="font-bold text-slate-700 truncate max-w-[120px]">${_0x11b}</div><div class="text-[10px] text-slate-400 font-bold uppercase">${_0x12c}</div></td><td class="p-4 text-right"><div class="font-bold ${_0x10a==='income'?'text-blue-600':'text-red-500'}">${_0x10a==='income'?'+':'-'} ‡∏ø${_0x20e.toLocaleString(undefined,{minimumFractionDigits:2})}</div>${_0x22a>0?`<div class="text-[9px] text-purple-400">VAT ‡∏ø${_0x22a.toFixed(2)}</div>`:''}</td></tr>`}});document.getElementById('totalIncome').innerText='‡∏ø'+_0x2e.inc.toLocaleString(undefined,{minimumFractionDigits:2});document.getElementById('totalExpense').innerText='‡∏ø'+_0x2e.exp.toLocaleString(undefined,{minimumFractionDigits:2});document.getElementById('netProfit').innerText='‡∏ø'+(_0x2e.inc-_0x2e.exp).toLocaleString(undefined,{minimumFractionDigits:2});document.getElementById('avgMargin').innerText=_0x2e.inc>0?(((_0x2e.inc-_0x2e.exp)/_0x2e.inc)*100).toFixed(1)+'%':'0%';renderROI(_0x3f);renderMonthly(_0x4a);renderTax(_0x2e);renderTaxMonthly(_0x5b)};window.renderROI=function(_0xa1){const _0xb2=document.getElementById('roiBody');_0xb2.innerHTML='';Object.entries(_0xa1).sort((_0xc3,_0xd4)=>_0xd4[1].inc-_0xc3[1].inc).forEach(([_0xe5,_0xf6])=>{const _0x11a=_0xf6.inc-_0xf6.exp;const _0x22b=_0xf6.exp>0?(_0x11a/_0xf6.exp*100):0;const _0x33c=_0xf6.inc>0?(_0x11a/_0xf6.inc*100):0;_0xb2.innerHTML+=`<tr><td class="p-4 font-bold text-slate-700">${_0xe5}</td><td class="p-4 text-right">‡∏ø${_0xf6.inc.toLocaleString()}</td><td class="p-4 text-right text-red-400">‡∏ø${_0xf6.exp.toLocaleString()}</td><td class="p-4 text-right ${_0x11a>=0?'text-green-600':'text-red-600'}">‡∏ø${_0x11a.toLocaleString()}</td><td class="p-4 text-center"><span class="px-2 py-1 rounded-full text-[10px] ${_0x33c>=20?'bg-green-100 text-green-700':'bg-yellow-100 text-yellow-700'}">ROI: ${_0x22b.toFixed(1)}% / Margin: ${_0x33c.toFixed(1)}%</span></td></tr>`})};window.renderMonthly=function(_0x1a2){const _0x2b3=document.getElementById('monthlyBody');_0x2b3.innerHTML='';Object.entries(_0x1a2).sort((_0x3c4,_0x4d5)=>_0x4d5[0].localeCompare(_0x3c4[0])).forEach(([_0x5e6,_0x6f7])=>{const _0x7a8=_0x6f7.inc-_0x6f7.exp;const [_0x8b9,_0x9ca]=_0x5e6.split('-');const _0x10d=new Date(_0x8b9,_0x9ca-1).toLocaleDateString('th-TH',{month:'long',year:'numeric'});_0x2b3.innerHTML+=`<tr><td class="p-4 text-slate-600">${_0x10d}</td><td class="p-4 text-right text-blue-600">‡∏ø${_0x6f7.inc.toLocaleString()}</td><td class="p-4 text-right text-red-400">‡∏ø${_0x6f7.exp.toLocaleString()}</td><td class="p-4 text-right font-bold ${_0x7a8>=0?'text-slate-700':'text-red-600'}">‡∏ø${_0x7a8.toLocaleString()}</td></tr>`})};window.renderTaxMonthly=function(_0x11a){const _0x22b=document.getElementById('taxMonthlyBody');_0x22b.innerHTML='';Object.entries(_0x11a).sort((_0x33c,_0x44d)=>_0x44d[0].localeCompare(_0x33c[0])).forEach(([_0x55e,_0x66f])=>{const [_0x77a,_0x88b]=_0x55e.split('-');const _0x99c=new Date(_0x77a,_0x88b-1).toLocaleDateString('th-TH',{month:'long',year:'numeric'});_0x22b.innerHTML+=`<tr class="border-b border-slate-50"><td class="p-4 text-slate-700 font-bold">${_0x99c}</td><td class="p-4 text-right text-slate-500 font-medium">‡∏ø${_0x66f.base.toLocaleString(undefined,{minimumFractionDigits:2})}</td><td class="p-4 text-right text-blue-600 font-bold">‡∏ø${_0x66f.vat.toLocaleString(undefined,{minimumFractionDigits:2})}</td><td class="p-4 text-right text-purple-600 font-bold">‡∏ø${_0x66f.wht.toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>`})};window.renderTax=function(_0x1a){const _0x2b=document.getElementById('taxContent');_0x2b.innerHTML=`<div class="bg-blue-50 p-6 rounded-2xl border border-blue-100"><h4 class="text-blue-800 font-bold mb-2">üõçÔ∏è ‡∏†‡∏≤‡∏©‡∏µ‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏∞‡∏™‡∏° (VAT)</h4><p class="text-2xl font-black text-blue-700">‡∏ø${_0x1a.vat.toLocaleString(undefined,{minimumFractionDigits:2})}</p></div><div class="bg-purple-50 p-6 rounded-2xl border border-purple-100"><h4 class="text-purple-800 font-bold mb-2">‚úÇÔ∏è ‡∏´‡∏±‡∏Å ‡∏ì ‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∞‡∏™‡∏° (WHT)</h4><p class="text-2xl font-black text-purple-700">‡∏ø${_0x1a.wht.toLocaleString(undefined,{minimumFractionDigits:2})}</p></div><div class="bg-slate-50 p-6 rounded-2xl border border-slate-200"><h4 class="text-slate-800 font-bold mb-2">üìà ‡∏†‡∏≤‡∏©‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÑ‡∏î‡πâ (‡∏ô‡∏¥‡∏ï‡∏¥‡∏Ø)</h4><p class="text-xl font-bold text-slate-600">‡∏ø${(_0x1a.exp*0.2).toLocaleString(undefined,{minimumFractionDigits:0})}</p><p class="text-[10px] text-slate-400 italic">* ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏†‡∏≤‡∏©‡∏µ 20%</p></div>`};document.getElementById('accountForm').addEventListener('submit',async(_0x11a)=>{_0x11a.preventDefault();const _0x22b=document.getElementById('submitBtn');_0x22b.disabled=true;_0x22b.innerText='‚åõ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';const _0x33c=calculateTax();const _0x44d={type:document.getElementById('type').value,project:document.getElementById('projectSelect').value,category:document.getElementById('category').value,description:document.getElementById('description').value,amount:_0x33c.amount,vat:_0x33c.vat,wht:_0x33c.wht,net:_0x33c.net};try{await fetch(_0x1a,{method:'POST',mode:'no-cors',body:JSON.stringify(_0x44d)});document.getElementById('accountForm').reset();calculateTax();alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');setTimeout(fetchData,1000)}catch(_0x55e){alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+_0x55e.message)}finally{_0x22b.disabled=false;_0x22b.innerText='‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' textContent}});window.calculateTax=function(){const _0x1a=parseFloat(document.getElementById('amount').value)||0;const _0x2b=document.getElementById('hasVat').checked;const _0x3c=parseFloat(document.getElementById('whtRate').value)||0;const _0x4d=_0x2b?_0x1a*0.07:0;const _0x5e=_0x1a*(_0x3c/100);const _0x6f=_0x1a+_0x4d-_0x5e;document.getElementById('displayVatText').innerText=_0x4d.toLocaleString(undefined,{minimumFractionDigits:2});document.getElementById('displayNet').innerText=_0x6f.toLocaleString(undefined,{minimumFractionDigits:2});return{amount:_0x1a,vat:_0x4d,wht:_0x5e,net:_0x6f}};window.switchTab=function(_0x1a){['dashboard','analysis','tax'].forEach(_0x2b=>{document.getElementById('view-'+_0x2b).classList.toggle('hidden',_0x2b!==_0x1a);document.getElementById('tab-'+_0x2b).className=_0x2b===_0x1a?'pb-2 font-bold nav-active whitespace-nowrap transition':'pb-2 font-bold text-slate-400 hover:text-slate-600 whitespace-nowrap transition'})};window.updateProjectOptions=function(){const _0x1a=['projectSelect','projectFilter'];_0x1a.forEach(_0x2b=>{const _0x3c=document.getElementById(_0x2b);const _0x4d=_0x3c.value;_0x3c.innerHTML=_0x2b==='projectFilter'?'<option value="all">üìÅ ‡∏ó‡∏∏‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</option>':'<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ --</option>';_0x3c.sort().forEach(_0x5e=>_0x3c.innerHTML+=`<option value="${_0x5e}">${_0x5e}</option>`);_0x3c.value=_0x4d})};window.manageProjects=function(){const _0x1a=document.getElementById('projectList');_0x1a.innerHTML='';_0x3c.forEach((_0x2b,_0x3d)=>{_0x1a.innerHTML+=`<div class="flex justify-between items-center bg-slate-50 p-3 rounded-xl border border-slate-100"><span class="text-sm font-medium text-slate-700">${_0x2b}</span><button onclick="removeProject(${_0x3d})" class="text-red-400 hover:text-red-600 px-2">‡∏•‡∏ö</button></div>`});document.getElementById('projectModal').classList.remove('hidden')};window.addProject=function(){const _0x1a=document.getElementById('newProjectName').value.trim();if(_0x1a&&!_0x3c.includes(_0x1a)){_0x3c.push(_0x1a);localStorage.setItem('xbuilts_projects_v3',JSON.stringify(_0x3c));document.getElementById('newProjectName').value='';updateProjectOptions();manageProjects()}};window.removeProject=function(_0x1a){if(confirm('‡∏•‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£?')){_0x3c.splice(_0x1a,1);localStorage.setItem('xbuilts_projects_v3',JSON.stringify(_0x3c));updateProjectOptions();manageProjects()}};window.closeProjectModal=function(){document.getElementById('projectModal').classList.add('hidden')};window.onload=()=>{updateProjectOptions();fetchData()}})();
